\begin{section}{Lifetimes}

  \setmintedinline{fontsize=\scriptsize}

  \begin{frame}
    \centerline{
      \huge{Lifetimes}
    }
  \end{frame}

  \begin{frame}[fragile]
    \frametitle{Brief Generics Recap}
    \begin{minted}{java}
      public <A> A genericFunction(A a1, A a2) {
        return a1;
      }
    \end{minted}
  \end{frame}

  \begin{frame}[fragile]
    \frametitle{Brief Generics Recap}
    \begin{minted}{java}
      public <A, B> A genericFunction(A a1, B a2) {
        return a1;
      }
    \end{minted}
  \end{frame}

  \begin{frame}[fragile]
    \frametitle{What do you expect this to do? \cite{RustLangEd}}
    \begin{minted}[fontsize=\scriptsize]{rust}
      pub fn main() {
        let v1 = vec!(1,2,3);
        let v2 = vec!(4,5,6);
        let result1 = do_something_1(&v1);
        let result2 = do_something_2(&v1, &v2);
        println!("{:?}", result1);
        println!("{:?}", result2);
      }

      fn do_something_1(v1: &Vec<u64>) -> &Vec<u64> {
        return v1;
      }

      fn do_something_2(v1: &Vec<u64>, v2: &Vec<u64>) -> &Vec<u64> {
        return v2;
      }
    \end{minted}
  \end{frame}

  \begin{frame}[fragile]
    \frametitle{Rust Befuddles Us}
    \begin{minted}[escapeinside=??,fontsize=\scriptsize]{rust}
      pub fn main() {
        let v1 = vec!(1,2,3);
        let v2 = vec!(4,5,6);
        let result1 = do_something_1(&v1);
        let result2 = do_something_2(&v1, &v2);
        println!("{:?}", result1);
        println!("{:?}", result2);
      }

      fn do_something_1(v1: &Vec<u64>) -> &Vec<u64> { ?\tikzmark{no_lifetime_error}?
        return v1;
      }

      fn do_something_2(v1: &Vec<u64>, v2: &Vec<u64>) -> &Vec<u64> ?\tikzmark{lifetime_error}? {
        return v2;
      }
    \end{minted}
    \begin{tikzpicture}[overlay,remember picture]
      \draw[thick,->] (pic cs:no_lifetime_error) ++(-1.5,-0.1) to[bend right]
      ++(-0.5,-0.5)node[below]{\tiny Rust knows the lifetime of returned vector should be same as input vector};
    \end{tikzpicture}
    \begin{tikzpicture}[overlay,remember picture]
      \draw[thick,->] (pic cs:lifetime_error) ++(-0.5,-0.1) to[bend left]
      ++(-0.5,-0.5)node[left]{\tiny Rust complains it doesn't know about lifetime of returned vector};
    \end{tikzpicture}
  \end{frame}

  \begin{frame}[fragile]
    \frametitle{The `Fix`}
    \begin{minted}[escapeinside=??,fontsize=\scriptsize]{rust}
      pub fn main() {
        let v1 = vec!(1,2,3);
        let v2 = vec!(4,5,6);
        let result1 = do_something_1(&v1);
        let result2 = do_something_2(&v1, &v2);
        println!("{:?}", result1);
        println!("{:?}", result2);
      }

      fn do_something_1(v1: &Vec<u64>) -> &Vec<u64> {
        return v1;
      }

      fn do_something_2<'a>(v1: &'a Vec<u64>, v2: &'a Vec<u64>) -> &'a Vec<u64> ?\tikzmark{lifetime_fix}? {
        return v2;
      }
    \end{minted}
    \begin{tikzpicture}[overlay,remember picture]
      \draw[thick,->] (pic cs:lifetime_fix) ++(-0.5,-0.1) to[bend left]
      ++(-0.5,-0.5)node[left]{\tiny We tell Rust that all vectors have the same lifetime};
    \end{tikzpicture}
  \end{frame}

    \begin{frame}[fragile]
    \frametitle{Why are Lifetimes necessary? \cite{RustLangCh10}}
    \begin{minted}[escapeinside=??,fontsize=\scriptsize]{rust}
      pub fn main() {
        let v1 = vec!(1,2,3);
        let result;
        {
          let v2 = vec!(4,5,6);
          result = do_something(&v1, &v2);
        }
        println!("{:?}", result);
      }

      fn do_something<'a>(v1: &'a Vec<u64>, v2: &'a Vec<u64>) -> &'a Vec<u64> {
        return v2;
      }
    \end{minted}
  \end{frame}

  \begin{frame}[fragile]
    \frametitle{Why are Lifetimes necessary?}
    \begin{minted}[escapeinside=??,fontsize=\scriptsize]{rust}
      pub fn main() {
        let v1 = vec!(1,2,3);
        let result;
        {
          let v2 = vec!(4,5,6);
          result = do_something_1(&v1, &v2);
        } ?\tikzmark{s2_lifetime_error}?
        println!("{:?}", result);
      } ?\tikzmark{s1_lifetime_error}?

      fn do_something<'a>(v1: &'a Vec<u64>, v2: &'a Vec<u64>) -> &'a Vec<u64> {
        return v2;
      }
    \end{minted}
    \begin{tikzpicture}[overlay,remember picture]
      \draw[thick,->] (pic cs:s2_lifetime_error) ++(0,0.1) --
      ++(5.5,0)node[right]{\tiny \mintinline{rust}{v2} is dropped here};
    \end{tikzpicture}
    \begin{tikzpicture}[overlay,remember picture]
      \draw[thick,->] (pic cs:s1_lifetime_error) ++(0,0.1) --
      ++(5.5,0)node[right]{\tiny \mintinline{rust}{v1} and \mintinline{rust}{result} are dropped here};
    \end{tikzpicture}
  \end{frame}

  \begin{frame}[fragile]
    \frametitle{The Lifetimes Fix}
    \begin{minted}[escapeinside=??,fontsize=\scriptsize]{rust}
      pub fn main() {
        let v1 = vec!(1,2,3);
        let result;
        {
          let v2 = vec!(4,5,6);
          result = do_something_2(&v1, &v2);
        }
        println!("{:?}", result);
      }

      fn do_something<'a, 'b>(v1: &'a Vec<u64>, v2: &'b Vec<u64>) -> &'b Vec<u64> {
        return v2;
      }
    \end{minted}
  \end{frame}

\end{section}
